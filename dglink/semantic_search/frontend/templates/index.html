<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NF Data Portal KG Semantic Search</title>

    <!-- Bootstrap CSS -->
    <link 
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
        rel="stylesheet" 
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
        crossorigin="anonymous"
    >

    <!-- Optional custom styles -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">

    <style>
        .option-img {
            width: 250px;
            height: auto;
        }
        .option-card {
            text-align: center;
        }
    </style>
</head>

<script>
document.addEventListener('DOMContentLoaded', function() {

    function setupAutocomplete(inputId, endpoint="/autocomplete") {
        const input = document.getElementById(inputId);
        const suggestionBox = document.createElement('ul');
        suggestionBox.classList.add('list-group', 'position-absolute', 'w-100', 'z-3');
        suggestionBox.style.maxHeight = "200px";
        suggestionBox.style.overflowY = "auto";
        input.parentNode.style.position = "relative";
        input.parentNode.appendChild(suggestionBox);

        let debounceTimeout;

        input.addEventListener('input', function() {
            clearTimeout(debounceTimeout);
            const query = input.value.trim();
            if (!query) {
                suggestionBox.innerHTML = '';
                return;
            }

            debounceTimeout = setTimeout(() => {
                fetch(`${endpoint}?inputId=${encodeURIComponent(inputId)}&query=${encodeURIComponent(query)}`)
                    .then(response => response.json())
                    .then(data => {
                        suggestionBox.innerHTML = '';
                        data.suggestions.forEach(s => {
                            const li = document.createElement('li');
                            li.classList.add('list-group-item', 'list-group-item-action');
                            li.textContent = s;
                            li.addEventListener('click', () => {
                                input.value = s;
                                suggestionBox.innerHTML = '';
                            });
                            suggestionBox.appendChild(li);
                        });
                    })
                    .catch(err => console.error('Error fetching autocomplete:', err));
            }, 300);
        });

        document.addEventListener('click', (e) => {
            if (!input.contains(e.target) && !suggestionBox.contains(e.target)) {
                suggestionBox.innerHTML = '';
            }
        });
    }

    // Initialize autocomplete for all fields
    setupAutocomplete('Agent');
    setupAutocomplete('Relation');
    setupAutocomplete('OtherAgent');
});
</script>





<body class="bg-light">
    <div class="container py-5">
        <h1 class="text-center mb-5">NF Data Portal KG Semantic Search</h1>

        <form method="POST" class="card shadow p-4">
            <div class="mb-3">
                <label for="Agent" class="form-label">Agent</label>
                <input type="text" id="Agent" name="Agent" class="form-control" 
                    value="{{ form_data.Agent }}" autocomplete="off">

            </div>

            <div class="mb-3">
                <label for="Relation" class="form-label">Relation</label>
                <input type="text" id="Relation" name="Relation" class="form-control" 
                    value="{{ form_data.Relation }}" autocomplete="off">

            </div>

            <div class="mb-4">
                <label for="OtherAgent" class="form-label">Other Agent</label>
                <input type="text" id="OtherAgent" name="OtherAgent" class="form-control" 
                    value="{{ form_data.OtherAgent }}" autocomplete="off">
            </div>

            <h5 class="mb-3">Agent Role:</h5>

            <div class="row text-center mb-4">
                <!-- Option 1 -->
                <div class="col-md-4 mb-3">
                    <div class="option-card card p-3">
                        <img 
                            src="{{ url_for('static', filename='subject_object.png') }}" 
                            alt="Subject/Object" 
                            class="option-img mx-auto mb-3"
                        >
                        <div class="form-check d-flex justify-content-center">
                        <input class="form-check-input me-2" 
                            type="radio" 
                            id="Subject/Object" 
                            name="QueryType" 
                            value="Subject/Object"
                            {% if form_data.QueryType == "Subject/Object" %}checked{% endif %}>
                        <label class="form-check-label" for="Subject/Object">Subject/Object</label>

                        </div>
                    </div>
                </div>

                <!-- Option 2 -->
                <div class="col-md-4 mb-3">
                    <div class="option-card card p-3">
                        <img 
                            src="{{ url_for('static', filename='subject.png') }}" 
                            alt="Subject" 
                            class="option-img mx-auto mb-3"
                        >
                        <div class="form-check d-flex justify-content-center">
                        <input class="form-check-input me-2" 
                            type="radio" 
                            id="Subject" 
                            name="QueryType" 
                            value="Subject"
                            {% if form_data.QueryType == "Subject" %}checked{% endif %}>
                        <label class="form-check-label" for="Subject">Subject</label>

                        </div>
                    </div>
                </div>

                <!-- Option 3 -->
                <div class="col-md-4 mb-3">
                    <div class="option-card card p-3">
                        <img 
                            src="{{ url_for('static', filename='object.png') }}" 
                            alt="Object" 
                            class="option-img mx-auto mb-3"
                        >
                        <div class="form-check d-flex justify-content-center">
                        <input class="form-check-input me-2" 
                            type="radio" 
                            id="Object" 
                            name="QueryType" 
                            value="Object"
                            {% if form_data.QueryType == "Object" %}checked{% endif %}>
                        <label class="form-check-label" for="Object">Object</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="text-center">
                <button type="submit" class="btn btn-primary btn-lg px-4">
                    Search
                </button>
            </div>
        </form>

    {% if result %}
    <div class="mt-5">
        <h2>Results:</h2>
        <ul class="list-group">
            {% for row in result %}
            <li class="list-group-item">
                <ul class="list-unstyled ms-3">
                    {% for entry in row %}
                    <li class="mb-1">
                        {% if entry.url %}
                            {{ entry.field }}:<a href="{{ entry.url }}" target="_blank" class="link-primary text-decoration-none">
                                 Link 
                            </a>
                        {% else %}
                            {{ entry.text }}
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    </div>

    <!-- Bootstrap JS (optional) -->
    <script 
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+Jv0a0I1pUcZ4l+Amk08y+YtC1g5r" 
        crossorigin="anonymous">
    </script>
</body>
</html>
